# План работ: AI Mastering

## Этап 1: MVP — Ядро системы (от загрузки до скачивания)

**Цель**: Собрать минимально жизнеспособный E2E-цикл. Пользователь загружает трек, система его обрабатывает (пока просто), и пользователь может его скачать.

1. **Инфраструктура и окружение** ✅

   - `docker-compose`: Mongo, RabbitMQ, MinIO.
   - `Makefile` для удобного локального запуска (`up`, `api`, `worker`).
   - Конфигурация через `.env` файлы.

2. **API: Загрузка и создание задачи** ✅

   - `POST /uploads/presign`: генерация URL для прямой загрузки в S3.
     - ➕ Добавить валидацию типа (`audio/wav`, `audio/aiff`) и размера файла.
   - `POST /jobs`: создание задачи на мастеринг.
     - Принимает `objectKey` загруженного файла (и референса, опционально).
     - Создаёт документ в MongoDB со статусом `queued`.
     - Отправляет сообщение с `jobId` в очередь RabbitMQ.

3. **Воркер: Базовая обработка** ✅

   - Подписка на очередь.
   - Скачивание исходного трека из S3.
   - MVP-процессинг: базовый `ffmpeg loudnorm`.
   - Загрузка результата (master.wav) и превью (preview.mp3) обратно в S3.
   - Обновление статуса задачи в MongoDB.

4. **Frontend: Минимальный интерфейс** ✅
   - Drag-and-drop загрузка.
   - Загрузка файла в S3 через presigned URL.
   - `POST /jobs` → переход на страницу задачи.
   - Статус задачи с polling.
   - Кнопка "Скачать" при `status=done`.

---

## Этап 2: "Интеллект" и качество мастеринга

**Цель**: Улучшить качество обработки, добавить "умные" функции и дать пользователю больше контроля.

5. **Глубокий анализ аудио**

   - LUFS, LRA, True Peak, Crest Factor.
   - Анализ спектра (бас, середина, верх).
   - Детектирование проблем (клиппинг, перегруз).
   - Сохранение `analysis.json` в S3.

6. **Decision Engine v1 (правила)**

   - Логика принятия решений по данным анализа.
   - Пример: низкий Crest Factor → экспандер.
   - Сохранение `decision.json`.

7. **Продвинутая цепочка обработки**

   - Переход к модульной цепочке (EQ, компрессия, лимитер).
   - Использование Python-библиотек (`pydub`, `librosa`).
   - Параметры берутся из `decision.json`.

8. **Мастеринг с референсом**
   - Загрузка референс-трека.
   - Сравнение тонального баланса, громкости.
   - Match-EQ / style transfer для мастеринга.

---

## Этап 3: Эксплуатация и надежность (Production-ready)

**Цель**: Сделать сервис стабильным и готовым к реальным нагрузкам.

9. **Надежность очередей**

   - Dead-Letter-Exchange (DLX).
   - Retrires с экспоненциальной задержкой.
   - В MongoDB: `attempts` и `lastError`.

10. **Логирование и мониторинг**

    - Структурированное логирование.
    - Сквозная трассировка (`request_id`).
    - OpenTelemetry + Grafana.

11. **Обработка ошибок и валидации**

    - API: лимиты по размеру/длине трека, ограничения задач.
    - Воркер: обработка битых файлов → статус `failed`.

12. **Тестирование**

    - Unit-тесты (анализ, decision engine).
    - E2E-тест: загрузка → статус → скачивание.

13. **Автоскейлинг и CI/CD**
    - Воркеры с авто-масштабированием.
    - Простая CI/CD (GitHub Actions / GitLab CI).

---

## Этап 4: Пользовательский опыт (UX) и администрирование

**Цель**: Сделать сервис удобным и понятным.

14. **Frontend улучшения**

    - A/B-плеер (до/после) с нормализацией громкости.
    - Визуализация анализа (графики).
    - AI-пояснение на основе LLM.

15. **Инстант-превью**

    - Быстрый mp3-сниппет через 10 секунд после загрузки.
    - Финальный мастеринг параллельно.

16. **Мобильный интерфейс**

    - Минимум адаптивной вёрстки под смартфоны.

17. **Админ-панель/CLI**

    - Просмотр задач, ошибок.
    - Ручной перезапуск или очистка.

18. **Подготовка к Production**
    - Единый S3-клиент (MinIO / AWS / Backblaze B2).
    - CDN + CORS для быстрой отдачи.

---

## Этап 5: Массовый сегмент (отличие от LANDR)

**Цель**: Дать начинающим продюсерам полный цикл "от трека до релиза".

19. **ИИ-обложки**

    - Генерация через SD/Flux.
    - Шаблоны для Spotify/Apple Music.

20. **Дистрибуция**

    - Интеграция с DistroKid-like сервисами или экспорт с метаданными.
    - Автозаполнение тегов (BPM, ключ, жанр).

21. **Соцсети**

    - Экспорт сниппетов для TikTok/IG.
    - Превью с обложкой и титрами.

22. **Геймификация**
    - Бейджи (“первый релиз”, “10 треков”).
    - Челленджи и уровни.

---

## Этап 6: Монетизация

**Цель**: Сделать модель доходной, но доступной.

23. **Freemium**

    - 1–2 мастера в месяц бесплатно (ограничения: водяной знак/mp3).

24. **Подписка**

    - От $5/мес для масс-сегмента.
    - Безлимит мастерингов + бонусы (обложки, соцсети).

25. **Pay-as-you-go**

    - $1–2 за мастеринг без подписки.

26. **Пакеты**
    - Например: $10 = 10 мастеров + 10 обложек.

---

## Этап 7: Комьюнити и рост

**Цель**: Повысить удержание пользователей и органический рост.

27. **Личный кабинет**

    - Архив релизов, портфолио.
    - Статистика по загрузкам.

28. **Сообщество**

    - Лайки/комментарии.
    - Мини-маркетплейс (продажа битов, коллаборации).

29. **B2B-интеграции**
    - Партнёрства с музыкальными школами.
    - White-label решения для студий.

---

# Итог

1. **MVP ядро** → **Интеллект и качество** → **Надёжность** → **UX**.
2. После стабильного ядра: **обложки + дистрибуция + соцсети**.
3. На этапе роста: **монетизация + сообщество**.
